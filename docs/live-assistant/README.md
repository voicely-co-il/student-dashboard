# Live Teaching Assistant - Technical Spec

## Overview
AI assistant that listens to lessons in real-time and provides silent tips to the teacher.

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Browser (Teacher's Device)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Microphone  â”‚â”€â”€â”€â–¶â”‚ Audio Buffer â”‚â”€â”€â”€â–¶â”‚ WebSocket     â”‚  â”‚
â”‚  â”‚ (MediaStream)â”‚    â”‚ (16kHz PCM)  â”‚    â”‚ Connection    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   React UI                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Transcript  â”‚  â”‚ Live Tips   â”‚  â”‚ Student      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ Display     â”‚  â”‚ Panel       â”‚  â”‚ History      â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ WebSocket (wss://api.soniox.com)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Soniox STT API                           â”‚
â”‚  - Real-time Hebrew transcription (7.5% WER)                â”‚
â”‚  - Speaker diarization (teacher vs student)                 â”‚
â”‚  - Hebrew + English code-switching                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Transcription chunks
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Supabase Edge Function                   â”‚
â”‚  analyze-lesson-live                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Transcript  â”‚â”€â”€â”€â–¶â”‚ Context     â”‚â”€â”€â”€â–¶â”‚ AI Analysis   â”‚   â”‚
â”‚  â”‚ Buffer      â”‚    â”‚ (Student    â”‚    â”‚ (Gemini)      â”‚   â”‚
â”‚  â”‚             â”‚    â”‚  History)   â”‚    â”‚               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Tips & Suggestions
                              â–¼
                    Back to Browser UI
```

## Data Flow

1. **Audio Capture** - Browser captures mic audio via MediaStream API
2. **Audio Processing** - Convert to 16kHz PCM, buffer for streaming
3. **Soniox Streaming** - WebSocket connection to Soniox for real-time STT
4. **Transcription** - Receive Hebrew text with speaker labels
5. **AI Analysis** - Every 30s or on trigger, analyze transcript for tips
6. **Display** - Show tips silently on teacher's screen

## Components

### Frontend (React)
```
src/
â”œâ”€â”€ pages/teacher/
â”‚   â””â”€â”€ LiveAssistant.tsx          # Main page
â”œâ”€â”€ components/live-assistant/
â”‚   â”œâ”€â”€ AudioCapture.tsx           # Microphone handling
â”‚   â”œâ”€â”€ TranscriptDisplay.tsx      # Live transcript view
â”‚   â”œâ”€â”€ TipsPanel.tsx              # AI suggestions panel
â”‚   â””â”€â”€ StudentContext.tsx         # Student history sidebar
â””â”€â”€ hooks/
    â”œâ”€â”€ useSonioxStream.ts         # Soniox WebSocket hook
    â”œâ”€â”€ useLiveTranscript.ts       # Transcript state management
    â””â”€â”€ useLessonAnalysis.ts       # AI analysis hook
```

### Backend (Edge Functions)
```
supabase/functions/
â”œâ”€â”€ soniox-token/                  # Generate temp API token
â”‚   â””â”€â”€ index.ts
â””â”€â”€ analyze-lesson-live/           # AI tip generation
    â””â”€â”€ index.ts
```

## API Integration

### Soniox WebSocket Flow
```typescript
// 1. Get temporary token from our backend
const { token } = await fetch('/api/soniox-token').then(r => r.json());

// 2. Connect to Soniox
const ws = new WebSocket('wss://api.soniox.com/transcribe-websocket');

// 3. Send config
ws.send(JSON.stringify({
  api_key: token,
  model: 'stt-rt-preview',
  language_hints: ['he', 'en'],
  enable_streaming_speaker_diarization: true,
  audio_format: 's16le',
  sample_rate: 16000,
  num_channels: 1
}));

// 4. Stream audio chunks
mediaRecorder.ondataavailable = (e) => {
  ws.send(e.data);
};

// 5. Receive transcriptions
ws.onmessage = (e) => {
  const { tokens, speaker } = JSON.parse(e.data);
  updateTranscript(tokens, speaker);
};
```

## UI Design

### Teacher View (Silent Tips)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ™ï¸ ×©×™×¢×•×¨ ×¤×¢×™×œ - ×“× ×™ ×›×”×Ÿ (45:12)              [â¸ï¸] [â¹ï¸]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ’¡ ×˜×™×¤×™×                             â”‚ â”‚ ğŸ‘¤ ×“× ×™      â”‚ â”‚
â”‚  â”‚                                      â”‚ â”‚             â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚ ×©×™×¢×•×¨ #47   â”‚ â”‚
â”‚  â”‚ â”‚ ğŸµ × ×¡×™ ×œ×”×•×¨×™×“ ×—×¦×™ ×˜×•×Ÿ -        â”‚   â”‚ â”‚ ×”×ª×§×“××•×ª:   â”‚ â”‚
â”‚  â”‚ â”‚    ×”×ª×œ××™×“ ××ª×××¥ ×‘×’×‘×•×”×•×ª       â”‚   â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 70% â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚             â”‚ â”‚
â”‚  â”‚                                      â”‚ â”‚ ×—×•×–×§×•×ª:     â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚ â€¢ × ×©×™××”    â”‚ â”‚
â”‚  â”‚ â”‚ ğŸ“ ××”×©×™×¢×•×¨ ×”×§×•×“×:              â”‚   â”‚ â”‚ â€¢ ×‘×™×˜×•×™    â”‚ â”‚
â”‚  â”‚ â”‚    ×¢×‘×“×ª× ×¢×œ head voice -      â”‚   â”‚ â”‚             â”‚ â”‚
â”‚  â”‚ â”‚    × ×¡×™ ×ª×¨×’×™×œ ×¡×™×¨× ×”            â”‚   â”‚ â”‚ ×œ×©×¤×¨:      â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚ â€¢ head     â”‚ â”‚
â”‚  â”‚                                      â”‚ â”‚   voice    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ×ª××œ×•×œ ×—×™ (××•×¡×ª×¨ ×›×‘×¨×™×¨×ª ××—×“×œ)                    [ğŸ‘ï¸] â”‚ â”‚
â”‚  â”‚ ×¢× ×‘×œ: ×‘×•××™ × ×¢×©×” ×ª×¨×’×™×œ × ×©×™××”...                       â”‚ â”‚
â”‚  â”‚ ×“× ×™: ××•×§×™×™, ×× ×™ ××•×›×Ÿ                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Costs

| Component | Cost/Month | Notes |
|-----------|------------|-------|
| Soniox STT | ~$6 (22â‚ª) | 50 hours @ $0.12/hr |
| Gemini AI | ~$2 | Tip generation |
| **Total** | **~$8 (30â‚ª)** | |

## Implementation Phases

### Phase 1: MVP (Week 1)
- [ ] Basic audio capture
- [ ] Soniox integration (text only)
- [ ] Simple transcript display
- [ ] Manual tip trigger

### Phase 2: Smart Tips (Week 2)
- [ ] AI analysis integration
- [ ] Student history context
- [ ] Automatic tip generation
- [ ] Song/exercise recommendations

### Phase 3: Polish (Week 3)
- [ ] Speaker diarization UI
- [ ] Lesson recording/export
- [ ] Analytics dashboard
- [ ] Mobile optimization

## Security Considerations

1. **API Keys** - Soniox temp tokens only (expire after use)
2. **Audio** - Not stored, streamed directly to Soniox
3. **Transcripts** - Option to save or discard after lesson
4. **Student Data** - Only accessible by authorized teachers
